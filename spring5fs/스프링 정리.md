# 스프링 정리

* 스프링 프레임워크의 주요 특징

  * 의존 주입(Dependency Injection : DI) 지원
  * AOP(Aspect-Oriented Programming) 지원
  * MVC 웹 프레임워크 제공
  * JDBC, JPA 연동, 선언적 트랜잭션 처리 등 DB연동 지원

* 메이븐의 의존 그래프 일부

  ![메이븐의 의존 그래프 일부](https://user-images.githubusercontent.com/75933619/127261668-4f6a5066-588b-406e-a0c0-fa4264f2c2cd.png)

  * AnnotationConfigApplicationContext

    * 자바 애노테이션을 이용한 클래스로부터 객체 설정 정보를 가져옴

  * GenericXmlApplicationContext

    * XML로부터 객체 설정 정보를 가져옴

  * GenericGroovyApplicationContext

    * 그루비 코드를 이용해 설정 정보를 가져옴

    ```
    ApplicationContest(또는 BeanFactory)는 빈 객체의 생성, 초기화, 보관, 제거 등을
    관리하고 있어서 ApplicationContext를 컨테이너(Container)라고도 부름
    ```

* @Configuration(설정)

  * 객체를 싱글톤으로 관리

* @Bean: 객체 등록

* @Autowirde: 의존 자동 주입

  * 객체가 자동으로 링크

* 싱글톤(Singleton) 객체

  * 스프링은 기본적으로 한 개의 @Bean 애노테이션에 대해 한 개의 빈 객체를 생성

    ```java
    package chap02;
    
    import org.springframework.context.annotation.AnnotationConfigApplicationContext;
    
    public class Main {
    
    	public static void main(String[] args) {
    		AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext(AppContext.class);
    		Greeter g1 = ctx.getBean("greeter", Greeter.class);
            Greeter g2 = ctx.getBean("greeter", Greeter.class);
    		System.out.println("(g1==g2)=" + (g1==g2));
    		ctx.close();
    	}
    }
    // (g1==g2)=true
    ```

* 관계도

![관계도](https://user-images.githubusercontent.com/75933619/127423059-8c26fc84-6bda-49b3-a314-33f187c974ca.png)

* 컴포넌트 스캔
  * 스프링이 직접 클래스를 검색해서 빈으로 등록해주는 기능

  * @ComponentScan(basePackages = {"spring"}) 이렇게 사용

    * 정의 
      * `@Component`를 가진 모든 대상을 가져와서 빈에 등록하기 위해 찾는 과정
         (`@Bean`을 통해 빈을 하나하나 지정할 필요가 없음)

    * 기본적인 컴포넌트 스캔 대상
      * `@Component` : 컴포넌트 스캔에서 사용
      * `@Controller` : 스프링 MVC 컨트롤러에서 사용
      * `@Configuration` : 스프링 설정 정보에서 사용

    * 컴포넌트 스캔 범위
      * `@ComponentScan` 어노테이션이 있는 파일의 패키지 아래를 찾는다.
      * `basePackages` / `basePackageClasses`로 지정도 가능

    * 옵션
      * 특정 어노테이션을 포함 / 제외시킬 수 있음
      * includeFilters : 컴포넌트 스캔 대상으로 추가
      * excludeFilters : 컴포넌트 스캔 대상에서 제외
      * FilterType 옵션
        - `ANNOTATION` : 기본값, 어노테이션을 인식해 동작
        - `ASSIGNABLE_TYPE` : 지정한 타입과 자식 타입을 인식해 동작
        - `ASPECTJ` : AspectJ 패턴 사용
        - `REGEX` : 정규 표현식
        - `CUSTOM` : TypeFilter이라는 인터페이스를 구현해서 처리

* 빈(Bean) 라이프사이클
  * 객체 생성 -> 의존 설정 -> 초기화 -> 소멸

* DB 연동

  * pom.xml 수정 내용

    ```xml
    <!-- 의존 주입 -->
    	<dependencies>
    		<dependency>
    			<groupId>org.springframework</groupId>
    			<artifactId>spring-context</artifactId>
    			<version>5.0.2.RELEASE</version>
    		</dependency>
    		<dependency>
    			<groupId>org.springframework</groupId>
    			<artifactId>spring-jdbc</artifactId>
    			<version>5.0.2.RELEASE</version>
    		</dependency>
    		<dependency>
    			<groupId>org.apache.tomcat</groupId>
    			<artifactId>tomcat-jdbc</artifactId>
    			<version>8.5.27</version>
    		</dependency>
    		<dependency>
    			<groupId>mysql</groupId>
    			<artifactId>mysql-connector-java</artifactId>
    			<version>5.1.45</version>
    		</dependency>
    	</dependencies>
        <!-- 여기까지  -->
    ```

  * 이클립스 -> window -> show view -> data source explorer 선택 -> 오른쪽 손잡는 모양 클릭 -> mysql -> new driver definition -> system version 5.1클릭 -> JAR List 이동 -> remove 후에 Add JAR 클릭해서 교수님이 보내주신 mysql-connector-java-8.0.23.jar 추가 OK -> database 자리를 변경 -> cookdb?serverTimezone=UTC 이걸로 -> test connection 클릭 -> Ping succeeded 나오면 성공

    * 만약 data source explorer 안되면 help -> install new software -> releases/2021-06 처럼 끝나는거 선택 -> Database Development 받기

  * src 폴더 우클릭 new -> folder 이름: sql -> sql 우클릭 new sqlFile 이름: ddl -> name 부분에 하나 선택할 수 있는거  클릭

  * 코드 작성

    ```mysql
    create user 'spring5'@'localhost' identified by 'spring5';
    
    create database spring5fs character set=utf8;
    
    grant all privileges on spring5fs.* to 'spring5'@'localhost';
    
    create table spring5fs.MEMBER(
    	ID int auto_increment primary key,
    	EMAIL varchar(255),
    	PASSWORD varchar(100),
    	NAME varchar(100),
    	REGDATE datetime,
    	unique key (EMAIL)
    ) engine=InnoDB character set = utf8;
    ```

    * 우클릭 -> excute all 클릭(전체 줄 실행) -> sql 워크벤치에 만들어졌으면 성공

* src/main/java 에 config 패키지에 AppCtx 파일 생성

  ```java
  package config;
  
  import org.apache.tomcat.jdbc.pool.DataSource;
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.transaction.annotation.EnableTransactionManagement;
  
  @Configuration
  @EnableTransactionManagement
  public class AppCtx {
  	
  	@Bean(destroyMethod = "close")
  	public DataSource dataSource() {
  		DataSource ds = new DataSource();
  		ds.setDriverClassName("com.mysql.jdbc.Driver");
  		ds.setUrl("jdbc:mysql://localhost:3306/spring5fs?serverTimezone=UTC");
  		ds.setUsername("spring5");
  		ds.setPassword("spring5");
  		ds.setInitialSize(2);
  		ds.setMaxActive(10);
  		ds.setTestWhileIdle(true);
  		ds.setMinEvictableIdleTimeMillis(60000*3);
  		ds.setTimeBetweenEvictionRunsMillis(10 * 1000);
  		return ds;
  	}
  }// 교재 187페이지에 설명 나와있는데 잘 안씀
  ```

# 웹 실행 순서

### chap 11 회원가입

* 웹 실행 -> web.xml 실행 -> 초기화 부분이 설정을 함

* ControllerConfig, MemberConfig, MvcConfig가 초기 설정이 됨

* ControllerConfig에서 RegisterController의 객체를 생성하고 Bean 객체를 등록

* MvcConfig에서 View관련된 설정을 함

* MemberConfig에서 데이터베이스 연결 설정과 데이터 관련 서비스들을 Bean 객체로 등록

* (MemberDao, MemberRegisterService, ChangePasswordService)

* URL -> /main을 입력하면 -> main.jsp 화면이 출력됨(/main은 MvcConfig에 따로 등록함)

* main.jsp에서 회원가입을 클릭 -> /register/step1을 Controller(Java)로 보내서 Mapping이 되어 있는지 확인을 하고 있는 경우 함수를 실행

* step1.jsp 실행이 되면 약관에 체크 버튼에 체크 여부를 true/false 값을 받아서 다음단계 버튼 클릭시 /register/step2 을 Controller(Java)로 보내서 Mapping이 되어 있는지 확인을 하고 있는 경우 함수를 실행

* step2.jsp 화면에 표출하기 전에 RegisterRequest 객체를 생성해서 model에 담아서 올려준 이후에 step2.jsp 화면출력

* email, name, password, confirmpassword에 값을 입력하고 버튼 입력시

* 입력한 값들은 RegisterRequest 객체에 담겨서 Controller(Java)로 내려옴

* MemberRegistService.register(RegisterRequest) 호출 됨

* email 중복 확인하고(MemberDao) 문제가 없으면 insert 실행(MemberDao)

* 문제가 없으면 MySql에 데이터가 저장됨

* 데이터베이스에 저장이 되고 register/step3가 호출되고 화면이 출력됨

* 때 이전에 RegisterRequest 객체에 담겨져 있는 name을 추출해서 step3 화면에 같이 출력함

* XXX 회원가입하셨습니다.

  [처음으로]

* 처음으로 클릭시 /main -> main.jsp가 호출

# 로그인화면

![image](https://user-images.githubusercontent.com/75933619/130025938-abfb1ce9-6881-418f-ad39-2bedfbad6bd9.png)
